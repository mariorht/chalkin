<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Chalkin</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/logoChalkin_invertido_16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/logoChalkin_invertido_32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/static/icons/logoChalkin_invertido_48.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/logoChalkin_invertido_180.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FF6B35">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Chalkin">
    
    <link rel="stylesheet" href="/static/css/app-shell.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B35;
            --primary-dark: #E55A2B;
            --secondary: #2EC4B6;
            --dark: #1A1A2E;
            --light: #F7F7F7;
            --gray: #6B7280;
            --error: #EF4444;
            --success: #22C55E;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
        }

        /* Header styles now in app-shell.css */

        /* Main */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Welcome */
        .welcome-section {
            margin-bottom: 2rem;
        }

        .welcome-section h1 {
            color: var(--dark);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .welcome-section p {
            color: var(--gray);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 0.75rem 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        }

        .stat-card .stat-icon {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-card .stat-icon svg {
            width: 100%;
            height: 100%;
        }

        .stat-card .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark);
        }

        .stat-card .stat-label {
            color: var(--gray);
            font-size: 0.75rem;
        }

        .stat-card.highlight {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .stat-card.highlight .stat-value,
        .stat-card.highlight .stat-label {
            color: white;
        }

        /* Actions */
        .quick-actions {
            margin-bottom: 1.5rem;
        }

        .quick-actions .btn {
            width: 100%;
            justify-content: center;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid #E5E7EB;
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Sections */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-header h2 {
            color: var(--dark);
            font-size: 1.3rem;
        }

        .section-header a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Sessions List */
        .sessions-list {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .session-item {
            display: flex;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #F3F4F6;
            transition: background 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .session-item:last-child {
            border-bottom: none;
        }

        .session-item:hover {
            background: #F9FAFB;
        }

        .session-item.active {
            background: rgba(34, 197, 94, 0.05);
            border-left: 4px solid var(--success);
        }

        .active-badge {
            background: var(--success);
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .session-date {
            width: 80px;
            text-align: center;
            margin-right: 1.5rem;
        }

        .session-date .day {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1;
        }

        .session-date .month {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
        }

        .session-info {
            flex: 1;
        }

        .session-gym {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .session-stats {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .session-stats span {
            margin-right: 1rem;
        }

        .session-grade {
            background: var(--secondary);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        /* Gyms Grid */
        .gyms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .gym-card {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .gym-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .gym-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--secondary), #1AA399);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .gym-info h3 {
            color: var(--dark);
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .gym-info p {
            color: var(--gray);
            font-size: 0.85rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #E5E7EB;
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .session-item {
                flex-wrap: wrap;
            }

            .session-grade {
                margin-top: 0.5rem;
            }
        }

        /* Friend Requests Styles */
        .friend-requests-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 1.5rem;
            color: white;
        }

        .friend-requests-card .section-header {
            margin-bottom: 1rem;
        }

        .friend-requests-card .section-header h2 {
            color: white;
        }

        .friend-requests-card .section-header a {
            color: rgba(255,255,255,0.8);
        }

        .friend-requests-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .friend-request-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.15);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .friend-request-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            overflow: hidden;
            flex-shrink: 0;
        }

        .friend-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .friend-request-actions {
            display: flex;
            gap: 0.5rem;
        }

        .friend-request-actions button {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .friend-request-actions button:hover {
            transform: scale(1.05);
        }

        .btn-accept {
            background: #28a745;
            color: white;
        }

        .btn-reject {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Activity Chart */
        .activity-chart-section {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .activity-chart-section h2 {
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .chart-container {
            height: 200px;
            position: relative;
            padding: 10px 0;
        }

        .chart-svg {
            width: 100%;
            height: 100%;
        }

        .chart-line {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .chart-line.sends {
            stroke: var(--primary);
        }

        .chart-line.sessions {
            stroke: var(--secondary);
        }

        .chart-area {
            opacity: 0.1;
        }

        .chart-area.sends {
            fill: var(--primary);
        }

        .chart-area.sessions {
            fill: var(--secondary);
        }

        .chart-dot {
            r: 4;
            stroke-width: 2;
            stroke: white;
            cursor: pointer;
            transition: r 0.2s;
        }

        .chart-dot:hover {
            r: 6;
        }

        .chart-dot.sends {
            fill: var(--primary);
        }

        .chart-dot.sessions {
            fill: var(--secondary);
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 0 5px;
        }

        .chart-label {
            font-size: 0.7rem;
            color: var(--gray);
            text-align: center;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #E5E7EB;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-dot.sends {
            background: var(--primary);
        }

        /* Activity Calendar Styles */
        .activity-calendar-section {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .activity-calendar-section h2 {
            color: var(--dark);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-month-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-nav-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .calendar-nav-btn:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .calendar-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .calendar-month-year {
            font-size: 1.1rem;
            color: var(--dark);
            font-weight: 600;
            text-align: center;
            margin-bottom: 0.75rem;
        }

        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .streak-number {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, minmax(45px, 60px));
            gap: 4px;
            margin-bottom: 4px;
            margin-left: auto;
            margin-right: auto;
            justify-content: center;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--gray);
            padding: 0.25rem 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(45px, 60px));
            gap: 4px;
            margin: 0 auto;
            justify-content: center;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: #F3F4F6;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--dark);
            position: relative;
        }

        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }

        .calendar-day.other-month {
            opacity: 0.4;
            color: #9CA3AF;
        }

        .calendar-day:not(.empty):hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .calendar-day.today {
            border: 2px solid var(--primary);
            font-weight: 700;
        }

        .calendar-day.level-1 {
            background: #FFE4DE;
        }

        .calendar-day.level-2 {
            background: #FFB8A8;
        }

        .calendar-day.level-3 {
            background: #FF8B72;
        }

        .calendar-day.level-4 {
            background: var(--primary);
            color: white;
        }

        .calendar-day.has-activity::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
        }

        .calendar-day.level-4.has-activity::after {
            background: white;
        }

        .calendar-legend {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--gray);
        }

        .calendar-legend-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .calendar-legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .calendar-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .calendar-grid,
            .calendar-weekdays {
                grid-template-columns: repeat(7, minmax(35px, 1fr));
            }
            
            .calendar-grid {
                gap: 3px;
            }
            
            .calendar-weekdays {
                gap: 3px;
            }
            
            .calendar-day {
                font-size: 0.7rem;
            }
            
            .calendar-weekday {
                font-size: 0.6rem;
            }
        }

        .legend-dot.sessions {
            background: var(--secondary);
        }

        .chart-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #E5E7EB;
        }

        .chart-summary-item {
            text-align: center;
        }

        .chart-summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        .chart-summary-label {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .chart-tooltip {
            position: absolute;
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
            white-space: nowrap;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .chart-tooltip::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--dark);
        }

    </style>
</head>
<body>
    <!-- Header y navegaci√≥n se inyectan por app-shell.js -->

    <main class="main-container">
        <section class="welcome-section">
            <h1>¬°Hola, <span id="userName">escalador</span>!</h1>
            <p id="welcomeMessage">Cargando tus estad√≠sticas...</p>
        </section>

        <section class="stats-grid" id="statsGrid">
            <div class="stat-card highlight">
                <div class="stat-icon"><svg viewBox="0 0 24 24" fill="#FFFFFF"><path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/></svg></div>
                <div class="stat-value" id="statSendsWeek">-</div>
                <div class="stat-label">Sends esta semana</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><svg viewBox="0 0 24 24" fill="#FFD700"><path d="M7 2v11h3v9l7-12h-4l4-8z"/></svg></div>
                <div class="stat-value" id="statFlashes">-</div>
                <div class="stat-label">Flashes</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><svg viewBox="0 0 24 24" fill="#2EC4B6"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z"/></svg></div>
                <div class="stat-value" id="statSessions">-</div>
                <div class="stat-label">Sesiones totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><svg viewBox="0 0 24 24" fill="#FFD700"><path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zM5 8V7h2v3.82C5.84 10.4 5 9.3 5 8zm14 0c0 1.3-.84 2.4-2 2.82V7h2v1z"/></svg></div>
                <div class="stat-value" id="statMaxGrade">-</div>
                <div class="stat-label">Grado m√°ximo</div>
            </div>
        </section>

        <!-- Friend Requests Section -->
        <section id="friendRequestsSection" style="display: none; margin-bottom: 1.5rem;">
            <div class="friend-requests-card">
                <div class="section-header">
                    <h2>üë• Solicitudes de amistad</h2>
                    <a href="/friends">Ver todas</a>
                </div>
                <div id="friendRequestsList" class="friend-requests-list"></div>
            </div>
        </section>

        <section class="quick-actions" style="display: flex; gap: 0.75rem;">
            <a href="/sessions/new" class="btn btn-primary" style="flex: 2;">
                <svg viewBox="0 0 24 24" fill="#FFFFFF" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;"><path d="M8 5v14l11-7z"/></svg>Iniciar actividad
            </a>
            <a href="/friends" class="btn btn-secondary" style="flex: 1;">
                <svg viewBox="0 0 24 24" fill="#4A5568" style="width:22px;height:22px;"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
            </a>
        </section>

        <!-- Activity Calendar Section -->
        <section class="activity-calendar-section">
            <div class="calendar-header">
                <h2><svg viewBox="0 0 24 24" fill="#2EC4B6" style="width:24px;height:24px;vertical-align:middle;margin-right:8px;"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z"/></svg>Calendario de actividad</h2>
                <div class="streak-badge">
                    <svg viewBox="0 0 24 24" fill="#FFFFFF" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;"><path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/></svg><span class="streak-number" id="consecutiveWeeks">0</span> <span id="weeksText">semanas consecutivas</span>
                </div>
            </div>
            <div class="calendar-month-year" id="calendarMonthYear"></div>
            <div class="calendar-weekdays">
                <div class="calendar-weekday">Lun</div>
                <div class="calendar-weekday">Mar</div>
                <div class="calendar-weekday">Mi√©</div>
                <div class="calendar-weekday">Jue</div>
                <div class="calendar-weekday">Vie</div>
                <div class="calendar-weekday">S√°b</div>
                <div class="calendar-weekday">Dom</div>
            </div>
            <div class="calendar-grid" id="activityCalendar">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <div class="calendar-month-nav" style="justify-content: center; margin-top: 1rem;">
                <button class="calendar-nav-btn" id="prevMonthBtn" onclick="changeMonth(-1)">‚Äπ</button>
                <button class="calendar-nav-btn" id="nextMonthBtn" onclick="changeMonth(1)">‚Ä∫</button>
            </div>
        </section>

        <!-- Activity Chart Section -->
        <section class="activity-chart-section">
            <h2><svg viewBox="0 0 24 24" fill="#4A5568" style="width:24px;height:24px;vertical-align:middle;margin-right:8px;"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>Actividad √∫ltimas 8 semanas</h2>
            <div class="chart-container" id="activityChart">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-dot sends"></div>
                    <span>Bloques √∫nicos</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot sessions"></div>
                    <span>Sesiones</span>
                </div>
            </div>
            <div class="chart-summary" id="chartSummary">
                <div class="chart-summary-item">
                    <div class="chart-summary-value" id="totalSends">-</div>
                    <div class="chart-summary-label">Bloques √∫nicos</div>
                </div>
                <div class="chart-summary-item">
                    <div class="chart-summary-value" id="totalSessions">-</div>
                    <div class="chart-summary-label">Sesiones</div>
                </div>
            </div>
        </section>
    </main>

    <script src="/static/js/app-shell.js"></script>
    <script>
        // Inicializar App Shell
        AppShell.init({ activePage: 'dashboard' });
        
        const API_URL = '/api';
        const token = AppShell.token;
        const user = AppShell.user || {};

        // Set user info
        document.getElementById('userName').textContent = user.username || 'escalador';

        // Usar funciones del AppShell
        function logout() {
            AppShell.logout();
        }

        async function fetchWithAuth(url) {
            return AppShell.fetchWithAuth(url);
        }

        async function loadStats() {
            try {
                const response = await fetchWithAuth(`${API_URL}/stats/me`);
                if (!response || !response.ok) return;
                
                const stats = await response.json();
                
                document.getElementById('statSendsWeek').textContent = stats.sends_this_week || 0;
                document.getElementById('statFlashes').textContent = stats.flashes_this_week || 0;
                document.getElementById('statSessions').textContent = stats.total_sessions || 0;
                document.getElementById('statMaxGrade').textContent = stats.max_grade_label || '-';
                
                // Update welcome message
                const message = stats.message || '¬°A escalar!';
                document.getElementById('welcomeMessage').textContent = message;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadActivityChart() {
            const container = document.getElementById('activityChart');
            
            try {
                const response = await fetchWithAuth(`${API_URL}/sessions?limit=50`);
                if (!response || !response.ok) {
                    container.innerHTML = '<div class="empty-state"><p>No hay datos</p></div>';
                    return;
                }
                
                const sessions = await response.json();
                
                // Parse UTC dates
                const parseUTCDate = (dateStr) => {
                    if (!dateStr) return null;
                    if (dateStr.includes('T')) {
                        if (dateStr.endsWith('Z') || dateStr.includes('+')) {
                            return new Date(dateStr);
                        }
                        return new Date(dateStr + 'Z');
                    }
                    // Date-only string (YYYY-MM-DD)
                    return new Date(dateStr + 'T00:00:00');
                };
                
                // Get last 8 weeks (starting from Monday)
                const weeks = [];
                const now = new Date();
                // Get day of week (0=Sunday, 1=Monday, ..., 6=Saturday)
                const dayOfWeek = now.getDay();
                // Convert to ISO week (0=Monday, 1=Tuesday, ..., 6=Sunday)
                const daysFromMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                
                for (let i = 7; i >= 0; i--) {
                    const weekStart = new Date(now);
                    weekStart.setDate(now.getDate() - (i * 7) - daysFromMonday);
                    weekStart.setHours(0, 0, 0, 0);
                    
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    weekEnd.setHours(23, 59, 59, 999);
                    
                    weeks.push({
                        start: weekStart,
                        end: weekEnd,
                        sends: 0,
                        sessions: 0,
                        label: `${weekStart.getDate()}/${weekStart.getMonth() + 1}`
                    });
                }
                
                // Aggregate data by week
                sessions.forEach(session => {
                    const sessionDate = parseUTCDate(session.date);
                    weeks.forEach(week => {
                        if (sessionDate >= week.start && sessionDate <= week.end) {
                            week.sends += session.total_ascents || 0;
                            week.sessions += 1;
                        }
                    });
                });
                
                // Find max values for scaling - independent scales for each line
                const maxSends = Math.max(...weeks.map(w => w.sends), 1);
                const maxSessions = Math.max(...weeks.map(w => w.sessions), 1);
                
                // SVG dimensions
                const width = container.clientWidth || 300;
                const height = 180;
                const paddingLeft = 35;
                const paddingRight = 35;
                const paddingTop = 20;
                const paddingBottom = 25;
                const chartWidth = width - paddingLeft - paddingRight;
                const chartHeight = height - paddingTop - paddingBottom;
                
                // Generate points - each line uses its OWN scale
                const sendsPoints = weeks.map((week, i) => ({
                    x: paddingLeft + (i * (chartWidth / (weeks.length - 1))),
                    y: paddingTop + chartHeight - ((week.sends / maxSends) * chartHeight * 0.85),
                    value: week.sends
                }));
                
                const sessionsPoints = weeks.map((week, i) => ({
                    x: paddingLeft + (i * (chartWidth / (weeks.length - 1))),
                    y: paddingTop + chartHeight - ((week.sessions / maxSessions) * chartHeight * 0.85),
                    value: week.sessions
                }));
                
                // Y-axis labels (3 levels: 0, mid, max)
                const sendsYLabels = [0, Math.round(maxSends / 2), maxSends];
                const sessionsYLabels = [0, Math.round(maxSessions / 2), maxSessions];
                
                // Create path for line
                const createLinePath = (points) => {
                    return points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');
                };
                
                // Create smooth path using cubic bezier
                const createSmoothPath = (points) => {
                    if (points.length < 2) return '';
                    let path = `M ${points[0].x} ${points[0].y}`;
                    for (let i = 1; i < points.length; i++) {
                        const prev = points[i - 1];
                        const curr = points[i];
                        const cpx = (prev.x + curr.x) / 2;
                        path += ` C ${cpx} ${prev.y}, ${cpx} ${curr.y}, ${curr.x} ${curr.y}`;
                    }
                    return path;
                };
                
                // Create area path
                const createAreaPath = (points, bottomY) => {
                    const linePath = createSmoothPath(points);
                    return `${linePath} L ${points[points.length - 1].x} ${bottomY} L ${points[0].x} ${bottomY} Z`;
                };
                
                const bottomY = paddingTop + chartHeight;
                
                // Render SVG
                container.innerHTML = `
                    <svg class="chart-svg" viewBox="0 0 ${width} ${height}">
                        <!-- Grid lines -->
                        <g class="chart-grid" stroke="#E5E7EB" stroke-width="1">
                            ${[0, 0.5, 1].map(pct => `
                                <line x1="${paddingLeft}" y1="${paddingTop + chartHeight * pct}" x2="${width - paddingRight}" y2="${paddingTop + chartHeight * pct}" stroke-dasharray="4,4" opacity="0.5"/>
                            `).join('')}
                        </g>
                        
                        <!-- Y-axis labels - Left (Bloques/naranja) -->
                        <g class="y-axis-left" fill="#FF6B35" font-size="10" font-weight="600">
                            <text x="${paddingLeft - 5}" y="${paddingTop + 4}" text-anchor="end">${sendsYLabels[2]}</text>
                            <text x="${paddingLeft - 5}" y="${paddingTop + chartHeight * 0.5 + 4}" text-anchor="end">${sendsYLabels[1]}</text>
                            <text x="${paddingLeft - 5}" y="${paddingTop + chartHeight + 4}" text-anchor="end">${sendsYLabels[0]}</text>
                        </g>
                        
                        <!-- Y-axis labels - Right (Sesiones/turquesa) -->
                        <g class="y-axis-right" fill="#2EC4B6" font-size="10" font-weight="600">
                            <text x="${width - paddingRight + 5}" y="${paddingTop + 4}" text-anchor="start">${sessionsYLabels[2]}</text>
                            <text x="${width - paddingRight + 5}" y="${paddingTop + chartHeight * 0.5 + 4}" text-anchor="start">${sessionsYLabels[1]}</text>
                            <text x="${width - paddingRight + 5}" y="${paddingTop + chartHeight + 4}" text-anchor="start">${sessionsYLabels[0]}</text>
                        </g>
                        
                        <!-- Area fills -->
                        <path class="chart-area sends" d="${createAreaPath(sendsPoints, bottomY)}" fill="#FF6B35" opacity="0.15"/>
                        <path class="chart-area sessions" d="${createAreaPath(sessionsPoints, bottomY)}" fill="#2EC4B6" opacity="0.1"/>
                        
                        <!-- Lines - Bloques (sends) first, then Sessions -->
                        <path class="chart-line sends" d="${createSmoothPath(sendsPoints)}" fill="none" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                        <path class="chart-line sessions" d="${createSmoothPath(sessionsPoints)}" fill="none" stroke="#2EC4B6" stroke-width="3" stroke-linecap="round"/>
                        
                        <!-- Dots - Bloques (sends) -->
                        ${sendsPoints.map((p, i) => `
                            <circle class="chart-dot sends" cx="${p.x}" cy="${p.y}" r="6" fill="#FF6B35" stroke="white" stroke-width="2" data-week="${i}" data-label="${weeks[i].label}" style="cursor:pointer"/>
                        `).join('')}
                        <!-- Dots - Sessions -->
                        ${sessionsPoints.map((p, i) => `
                            <circle class="chart-dot sessions" cx="${p.x}" cy="${p.y}" r="5" fill="#2EC4B6" stroke="white" stroke-width="2" data-week="${i}" data-label="${weeks[i].label}" style="cursor:pointer"/>
                        `).join('')}
                    </svg>
                    <div class="chart-tooltip" id="chartTooltip"></div>
                    <div class="chart-labels">
                        ${weeks.map(w => `<span class="chart-label">${w.label}</span>`).join('')}
                    </div>
                `;
                
                // Add click/touch events to dots
                container.querySelectorAll('.chart-dot').forEach(dot => {
                    const showTooltip = (e) => {
                        const tooltip = document.getElementById('chartTooltip');
                        const weekIndex = parseInt(dot.dataset.week);
                        const week = weeks[weekIndex];
                        const label = dot.dataset.label;
                        
                        tooltip.innerHTML = `
                            <div style="font-weight:600; margin-bottom:4px">Semana ${label}</div>
                            <div><span style="color:#FF6B35">‚óè</span> ${week.sends} bloques</div>
                            <div><span style="color:#2EC4B6">‚óè</span> ${week.sessions} sesiones</div>
                        `;
                        tooltip.style.opacity = '1';
                        
                        // Position tooltip
                        const dotX = parseFloat(dot.getAttribute('cx'));
                        const dotY = parseFloat(dot.getAttribute('cy'));
                        
                        tooltip.style.left = `${dotX}px`;
                        tooltip.style.top = `${dotY - 60}px`;
                        tooltip.style.transform = 'translateX(-50%)';
                    };
                    
                    dot.addEventListener('click', showTooltip);
                    dot.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        showTooltip(e);
                    });
                });
                
                // Hide tooltip on click outside
                container.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('chart-dot')) {
                        document.getElementById('chartTooltip').style.opacity = '0';
                    }
                });
                
                // Update summary
                const totalSends = weeks.reduce((sum, w) => sum + w.sends, 0);
                const totalSessions = weeks.reduce((sum, w) => sum + w.sessions, 0);
                
                document.getElementById('totalSends').textContent = totalSends;
                document.getElementById('totalSessions').textContent = totalSessions;
                
            } catch (error) {
                console.error('Error loading activity chart:', error);
                container.innerHTML = '<div class="empty-state"><p>Error cargando datos</p></div>';
            }
        }

        async function loadFriendRequests() {
            try {
                const response = await fetchWithAuth(`${API_URL}/social/friends/requests`);
                if (!response || !response.ok) return;
                
                const requests = await response.json();
                
                // Update nav badge using AppShell
                AppShell.updateFriendsBadge(requests.length);
                
                // Show section if there are requests
                if (requests.length === 0) return;
                
                const section = document.getElementById('friendRequestsSection');
                const container = document.getElementById('friendRequestsList');
                
                section.style.display = 'block';
                
                container.innerHTML = requests.slice(0, 3).map(req => `
                    <div class="friend-request-item" id="request-${req.id}">
                        <div class="friend-request-info">
                            <div class="friend-avatar">
                                ${req.user_profile_picture ? 
                                    `<img src="${req.user_profile_picture}" alt="${req.user_username}">` : 
                                    req.user_username.charAt(0).toUpperCase()
                                }
                            </div>
                            <div>
                                <strong>${req.user_username}</strong>
                                <div style="font-size: 0.8rem; opacity: 0.8;">quiere ser tu amigo</div>
                            </div>
                        </div>
                        <div class="friend-request-actions">
                            <button class="btn-accept" onclick="acceptRequest(${req.id})">‚úì Aceptar</button>
                            <button class="btn-reject" onclick="rejectRequest(${req.id})">‚úó</button>
                        </div>
                    </div>
                `).join('');
                
                if (requests.length > 3) {
                    container.innerHTML += `
                        <a href="/friends" style="text-align: center; display: block; color: rgba(255,255,255,0.8); margin-top: 0.5rem;">
                            Ver ${requests.length - 3} m√°s...
                        </a>
                    `;
                }
            } catch (error) {
                console.error('Error loading friend requests:', error);
            }
        }

        async function acceptRequest(requestId) {
            try {
                const response = await fetch(`${API_URL}/social/friends/requests/${requestId}/accept`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    document.getElementById(`request-${requestId}`).remove();
                    // Check if section should be hidden
                    const container = document.getElementById('friendRequestsList');
                    const remaining = container.querySelectorAll('.friend-request-item').length;
                    if (remaining === 0) {
                        document.getElementById('friendRequestsSection').style.display = 'none';
                    }
                    // Update nav badge using AppShell
                    AppShell.updateFriendsBadge(remaining);
                }
            } catch (error) {
                console.error('Error accepting request:', error);
            }
        }

        async function rejectRequest(requestId) {
            try {
                const response = await fetch(`${API_URL}/social/friends/requests/${requestId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok || response.status === 204) {
                    document.getElementById(`request-${requestId}`).remove();
                    const container = document.getElementById('friendRequestsList');
                    const remaining = container.querySelectorAll('.friend-request-item').length;
                    if (remaining === 0) {
                        document.getElementById('friendRequestsSection').style.display = 'none';
                    }
                    // Update nav badge using AppShell
                    AppShell.updateFriendsBadge(remaining);
                }
            } catch (error) {
                console.error('Error rejecting request:', error);
            }
        }

        // Calendar navigation state - Initialize BEFORE loading
        let currentCalendarYear = new Date().getFullYear();
        let currentCalendarMonth = new Date().getMonth() + 1; // 1-12

        // Load all data
        loadStats();
        loadActivityCalendar();
        loadActivityChart();
        loadFriendRequests();
        
        function changeMonth(delta) {
            const today = new Date();
            currentCalendarMonth += delta;
            
            if (currentCalendarMonth > 12) {
                currentCalendarMonth = 1;
                currentCalendarYear += 1;
            } else if (currentCalendarMonth < 1) {
                currentCalendarMonth = 12;
                currentCalendarYear -= 1;
            }
            
            // Don't allow future months
            if (currentCalendarYear > today.getFullYear() || 
                (currentCalendarYear === today.getFullYear() && currentCalendarMonth > today.getMonth() + 1)) {
                currentCalendarYear = today.getFullYear();
                currentCalendarMonth = today.getMonth() + 1;
            }
            
            // Don't go back more than 12 months
            const requestedDate = new Date(currentCalendarYear, currentCalendarMonth - 1, 1);
            const oneYearAgo = new Date(today.getFullYear(), today.getMonth() - 11, 1);
            if (requestedDate < oneYearAgo) {
                currentCalendarYear = oneYearAgo.getFullYear();
                currentCalendarMonth = oneYearAgo.getMonth() + 1;
            }
            
            loadActivityCalendar();
            updateNavigationButtons();
        }
        
        function updateNavigationButtons() {
            const today = new Date();
            const prevBtn = document.getElementById('prevMonthBtn');
            const nextBtn = document.getElementById('nextMonthBtn');
            
            // Check if at limit (12 months back)
            const requestedDate = new Date(currentCalendarYear, currentCalendarMonth - 1, 1);
            const oneYearAgo = new Date(today.getFullYear(), today.getMonth() - 11, 1);
            prevBtn.disabled = requestedDate <= oneYearAgo;
            
            // Check if at current month
            const isCurrentMonth = currentCalendarYear === today.getFullYear() && 
                                   currentCalendarMonth === today.getMonth() + 1;
            nextBtn.disabled = isCurrentMonth;
        }
        
        async function loadActivityCalendar() {
            const calendarContainer = document.getElementById('activityCalendar');
            const streakElement = document.getElementById('consecutiveWeeks');
            const monthYearElement = document.getElementById('calendarMonthYear');
            
            try {
                const response = await fetchWithAuth(`${API_URL}/stats/activity-calendar?year=${currentCalendarYear}&month=${currentCalendarMonth}`);
                if (!response || !response.ok) {
                    calendarContainer.innerHTML = '<div class="empty-state"><p>No hay datos</p></div>';
                    return;
                }
                
                const data = await response.json();
                const activityDays = data.activity_days || {};
                const consecutiveWeeks = data.consecutive_weeks || 0;
                const year = data.year;
                const month = data.month;
                
                // Update state with returned values (in case backend adjusted them)
                currentCalendarYear = year;
                currentCalendarMonth = month;
                
                // Update streak badge
                streakElement.textContent = consecutiveWeeks;
                const weeksText = document.getElementById('weeksText');
                weeksText.textContent = consecutiveWeeks === 1 ? 'semana consecutiva' : 'semanas consecutivas';
                
                // Set month/year display
                const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                                   'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                monthYearElement.textContent = `${monthNames[month - 1]} ${year}`;
                
                // Get first and last day of month
                const firstDay = new Date(year, month - 1, 1);
                const lastDay = new Date(year, month, 0);
                
                // Get day of week for first day (0=Sunday, 1=Monday, etc.)
                // Convert to Monday=0, Sunday=6
                let firstDayOfWeek = firstDay.getDay() - 1;
                if (firstDayOfWeek < 0) firstDayOfWeek = 6;
                
                // Calculate max sessions per day for intensity levels
                const counts = Object.values(activityDays);
                const maxCount = Math.max(...counts, 1);
                
                // Generate calendar grid
                let html = '';
                const today = new Date();
                
                // Add days from previous month to complete first week
                if (firstDayOfWeek > 0) {
                    const prevMonth = month === 1 ? 12 : month - 1;
                    const prevYear = month === 1 ? year - 1 : year;
                    const lastDayPrevMonth = new Date(prevYear, prevMonth, 0).getDate();
                    
                    for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                        const day = lastDayPrevMonth - i;
                        const dateStr = `${prevYear}-${String(prevMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const count = activityDays[dateStr] || 0;
                        
                        let level = 0;
                        if (count > 0) {
                            if (maxCount === 1) {
                                level = 4;
                            } else {
                                const intensity = count / maxCount;
                                if (intensity >= 0.75) level = 4;
                                else if (intensity >= 0.5) level = 3;
                                else if (intensity >= 0.25) level = 2;
                                else level = 1;
                            }
                        }
                        
                        const levelClass = level > 0 ? `level-${level}` : '';
                        const hasActivity = count > 0 ? 'has-activity' : '';
                        const title = count > 0 ? `${count} sesi√≥n${count > 1 ? 'es' : ''}` : 'Sin actividad';
                        
                        html += `<div class="calendar-day other-month ${levelClass} ${hasActivity}" title="${title}">${day}</div>`;
                    }
                }
                
                // Add days of the month
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const currentDate = new Date(year, month - 1, day);
                    // Build date string manually to avoid timezone issues
                    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const count = activityDays[dateStr] || 0;
                    
                    // Determine intensity level (0-4)
                    let level = 0;
                    if (count > 0) {
                        if (maxCount === 1) {
                            level = 4;
                        } else {
                            const intensity = count / maxCount;
                            if (intensity >= 0.75) level = 4;
                            else if (intensity >= 0.5) level = 3;
                            else if (intensity >= 0.25) level = 2;
                            else level = 1;
                        }
                    }
                    
                    const levelClass = level > 0 ? `level-${level}` : '';
                    const hasActivity = count > 0 ? 'has-activity' : '';
                    const isToday = currentDate.toDateString() === today.toDateString() ? 'today' : '';
                    const title = count > 0 ? `${count} sesi√≥n${count > 1 ? 'es' : ''}` : 'Sin actividad';
                    
                    html += `<div class="calendar-day ${levelClass} ${hasActivity} ${isToday}" title="${title}">${day}</div>`;
                }
                
                // Add days from next month to complete last week
                const totalDays = firstDayOfWeek + lastDay.getDate();
                const remainingDays = 7 - (totalDays % 7);
                if (remainingDays < 7) {
                    const nextMonth = month === 12 ? 1 : month + 1;
                    const nextYear = month === 12 ? year + 1 : year;
                    
                    for (let day = 1; day <= remainingDays; day++) {
                        const dateStr = `${nextYear}-${String(nextMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const count = activityDays[dateStr] || 0;
                        
                        let level = 0;
                        if (count > 0) {
                            if (maxCount === 1) {
                                level = 4;
                            } else {
                                const intensity = count / maxCount;
                                if (intensity >= 0.75) level = 4;
                                else if (intensity >= 0.5) level = 3;
                                else if (intensity >= 0.25) level = 2;
                                else level = 1;
                            }
                        }
                        
                        const levelClass = level > 0 ? `level-${level}` : '';
                        const hasActivity = count > 0 ? 'has-activity' : '';
                        const title = count > 0 ? `${count} sesi√≥n${count > 1 ? 'es' : ''}` : 'Sin actividad';
                        
                        html += `<div class="calendar-day other-month ${levelClass} ${hasActivity}" title="${title}">${day}</div>`;
                    }
                }
                
                calendarContainer.innerHTML = html;
                updateNavigationButtons();
                
            } catch (error) {
                console.error('Error loading activity calendar:', error);
                calendarContainer.innerHTML = '<div class="empty-state"><p>Error al cargar</p></div>';
            }
        }
        
        function formatDate(date) {
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }
        
        // Load all data
        loadStats();
        loadActivityChart();
        loadFriendRequests();
        
        // Redimensionar gr√°fico al cambiar tama√±o de ventana
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                loadActivityChart();
            }, 250);
        });
    </script>
</body>
</html>
